<!-- Header -->
<header class="fixed top-0 left-0 right-0 bg-white/95 dark:bg-gray-900/95 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700 z-40">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
            <!-- Logo and Site Title -->
            <div class="flex items-center">
                <!-- Mobile Menu Button -->
                <button id="mobile-menu-btn" 
                        class="lg:hidden p-2 rounded-md text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors mr-3"
                        aria-label="Toggle navigation menu">
                    <span class="block mobile-menu-icon">‚ò∞</span>
                    <span class="hidden mobile-close-icon">‚úï</span>
                </button>
                
                <!-- Logo -->
                <a href="{{ '/' | relative_url }}" class="flex items-center">
                    <div class="flex items-center">
                        <!-- Custom logo or icon -->
                        <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center mr-3">
                            <span class="text-white font-bold text-sm">F</span>
                        </div>
                        <div class="hidden sm:block">
                            <span class="text-xl font-bold text-gray-900 dark:text-white">{{ site.theme_config.logo | default: site.title }}</span>
                            <span class="text-sm text-gray-500 dark:text-gray-400 ml-2 hidden md:inline">v3.0.0</span>
                        </div>
                    </div>
                </a>
            </div>

            <!-- Desktop Navigation -->
            <nav class="hidden lg:flex items-center space-x-8">
                {% for item in site.navigation.main %}
                    {% if item.children %}
                        <!-- Dropdown Menu -->
                        <div class="relative group">
                            <button class="flex items-center text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 px-3 py-2 text-sm font-medium transition-colors">
                                {{ item.title }}
                                ‚ñº
                            </button>
                            <div class="dropdown-menu absolute top-full left-0 mt-1 w-48 rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200" style="background: white !important; border: 1px solid #e5e7eb !important; z-index: 9999 !important; box-shadow: 0 10px 25px rgba(0,0,0,0.15) !important;">
                                {% for child in item.children %}
                                <a href="{{ child.url | relative_url }}" 
                                   class="dropdown-item block px-4 py-2 text-sm transition-colors first:rounded-t-md last:rounded-b-md" style="color: #374151 !important; background: transparent !important;" onmouseover="this.style.background='#f9fafb !important'; this.style.color='#2563eb !important';" onmouseout="this.style.background='transparent !important'; this.style.color='#374151 !important';">
                                    {{ child.title }}
                                </a>
                                {% endfor %}
                            </div>
                        </div>
                    {% else %}
                        <a href="{{ item.url | relative_url }}" 
                           class="text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 px-3 py-2 text-sm font-medium transition-colors {% if page.url == item.url %}text-blue-600 dark:text-blue-400{% endif %}">
                            {{ item.title }}
                        </a>
                    {% endif %}
                {% endfor %}
            </nav>

            <!-- Right Side Actions -->
            <div class="flex items-center space-x-3">
                <!-- Search Button -->
                {% if site.theme_config.search_enabled %}
                <button id="search-btn" 
                        class="p-2 rounded-md text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
                        aria-label="Search documentation">
                    üîç
                </button>
                {% endif %}

                <!-- Dark Mode Toggle -->
                {% if site.theme_config.dark_mode %}
                <button id="theme-toggle" 
                        class="p-2 rounded-md text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
                        aria-label="Toggle dark mode">
                    <span class="dark:hidden">‚òÄÔ∏è</span>
                    <span class="hidden dark:block">üåô</span>
                </button>
                {% endif %}

                <!-- GitHub Link -->
                {% if site.theme_config.github_url %}
                <a href="{{ site.theme_config.github_url }}" 
                   target="_blank" 
                   rel="noopener"
                   class="p-2 rounded-md text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
                   aria-label="View on GitHub">
                    üêô
                </a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Mobile Navigation Menu -->
    <div id="mobile-menu" class="lg:hidden fixed top-16 left-0 right-0 transform -translate-y-full transition-transform duration-300 ease-in-out" 
         style="background: white !important; border-bottom: 1px solid #e5e7eb !important; z-index: 9998 !important;">
        <div class="px-4 py-2 space-y-1 max-h-screen overflow-y-auto">
            {% for item in site.navigation.main %}
                {% if item.children %}
                    <!-- Mobile Dropdown -->
                    <div class="mobile-dropdown">
                        <button class="mobile-dropdown-toggle w-full flex items-center justify-between px-3 py-2 text-sm font-medium hover:bg-gray-50 rounded-md transition-colors" 
                                style="color: #374151 !important; background: transparent !important;">
                            {{ item.title }}
                            <span class="mobile-chevron">‚ñº</span>
                        </button>
                        <div class="mobile-dropdown-content hidden ml-4 mt-1 space-y-1">
                            {% for child in item.children %}
                            <a href="{{ child.url | relative_url }}" 
                               class="block px-3 py-2 text-sm hover:bg-gray-50 rounded-md transition-colors" 
                               style="color: #6b7280 !important; background: transparent !important;">
                                {{ child.title }}
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                {% else %}
                    <a href="{{ item.url | relative_url }}" 
                       class="block px-3 py-2 text-sm font-medium hover:bg-gray-50 rounded-md transition-colors {% if page.url == item.url %}bg-blue-50{% endif %}" 
                       style="color: #374151 !important; background: transparent !important;">
                        {{ item.title }}
                    </a>
                {% endif %}
            {% endfor %}
        </div>
    </div>
</header>

<!-- Mobile Menu Spacer -->
<div class="h-16"></div>

<!-- Inline JavaScript for immediate execution -->
<script>
// Execute immediately when DOM loads
document.addEventListener('DOMContentLoaded', function() {
    // Mobile menu functionality
    const btn = document.getElementById('mobile-menu-btn');
    const menu = document.getElementById('mobile-menu');
    
    if (btn && menu) {
        let isOpen = false;
        
        btn.onclick = function() {
            isOpen = !isOpen;
            
            if (isOpen) {
                menu.style.transform = 'translateY(0)';
                menu.style.background = 'white';
                menu.style.borderBottom = '1px solid #e5e7eb';
                btn.querySelector('.mobile-menu-icon').style.display = 'none';
                btn.querySelector('.mobile-close-icon').style.display = 'block';
            } else {
                menu.style.transform = 'translateY(-100%)';
                btn.querySelector('.mobile-menu-icon').style.display = 'block';
                btn.querySelector('.mobile-close-icon').style.display = 'none';
            }
        };

        // Handle dropdown toggles
        const toggles = document.querySelectorAll('.mobile-dropdown-toggle');
        toggles.forEach(function(toggle) {
            toggle.onclick = function(e) {
                e.preventDefault();
                const content = this.parentElement.querySelector('.mobile-dropdown-content');
                const chevron = this.querySelector('.mobile-chevron');
                
                if (content && chevron) {
                    if (content.classList.contains('hidden')) {
                        content.classList.remove('hidden');
                        chevron.innerHTML = '‚ñ≤';
                    } else {
                        content.classList.add('hidden');
                        chevron.innerHTML = '‚ñº';
                    }
                }
            };
        });

        // Close menu when clicking links
        menu.onclick = function(e) {
            if (e.target.tagName === 'A' && !e.target.classList.contains('mobile-dropdown-toggle')) {
                isOpen = false;
                menu.style.transform = 'translateY(-100%)';
                btn.querySelector('.mobile-menu-icon').style.display = 'block';
                btn.querySelector('.mobile-close-icon').style.display = 'none';
            }
        };
    }

    // Force dropdown backgrounds for desktop
    const dropdowns = document.querySelectorAll('.dropdown-menu');
    dropdowns.forEach(function(dropdown) {
        dropdown.style.background = 'white !important';
        dropdown.style.border = '1px solid #e5e7eb !important';
        dropdown.style.zIndex = '9999 !important';
        dropdown.style.boxShadow = '0 10px 25px rgba(0,0,0,0.15) !important';
    });

    // Handle dark mode for dropdowns and mobile menu
    function updateDarkMode() {
        const isDark = document.documentElement.classList.contains('dark');
        
        // Update dropdowns
        dropdowns.forEach(function(dropdown) {
            if (isDark) {
                dropdown.style.background = '#1f2937 !important';
                dropdown.style.borderColor = '#4b5563 !important';
            } else {
                dropdown.style.background = 'white !important';
                dropdown.style.borderColor = '#e5e7eb !important';
            }
        });
        
        // Update mobile menu
        if (menu) {
            if (isDark) {
                menu.style.background = '#1f2937';
                menu.style.borderColor = '#4b5563';
                menu.style.color = '#d1d5db';
            } else {
                menu.style.background = 'white';
                menu.style.borderColor = '#e5e7eb';
                menu.style.color = '#374151';
            }
        }
    }

    // Watch for dark mode changes
    const observer = new MutationObserver(updateDarkMode);
    observer.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });
    
    // Initial dark mode check
    updateDarkMode();
});
</script>